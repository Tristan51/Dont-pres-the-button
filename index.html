<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<head>
    <title>WARNING: DO NOT PRESS THE BUTTON</title>
    <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
    <style>
        /* === PRESERVED ALL ORIGINAL STYLES === */
        body {
            background-color: #FFFFFF;
            margin: 0;
            padding: 0;
            font-family: "Times New Roman", Times, serif;
            color: #000000;
            text-align: center;
        }
        #container {
            width: 600px;
            margin: 20px auto;
            border: 3px double #000000;
            padding: 10px;
            background-color: #F0F0F0;
        }
        #button {
            width: 150px;
            height: 150px;
            background-color: #FF0000 !important;
            margin: 20px auto;
            border: 4px outset #880000 !important;
            cursor: pointer;
            display: block;
            transition: all 0.1s ease;
            box-shadow: 0 5px 0 #CC0000;
            position: relative;
        }
        #button:active {
            transform: translateY(5px);
            box-shadow: 0 2px 0 #CC0000;
            border-style: inset !important;
        }
        .counter {
            font-family: "Courier New", Courier, monospace;
            font-size: 14px;
            color: #000000;
            background-color: #DDDDDD;
            padding: 2px 5px;
            border: 1px solid #999999;
        }
        .message {
            font-family: Arial, Helvetica, sans-serif;
            font-size: 12px;
            color: #FF0000;
            background-color: #FFFFCC;
            padding: 5px;
            border: 1px dotted #FF9900;
            margin: 10px 0;
        }
        /* === END OF PRESERVED STYLES === */
    </style>
</head>
<body bgcolor="#FFFFFF" text="#000000">
    <!-- Preserved all HTML structure -->
    <div id="container">
        <h1><blink>⚠️ DANGER ⚠️</blink></h1>
        <div id="counter" class="counter">PRESSES: 0</div>
        <div id="button"></div>
        <div id="message" class="message">STATUS: NOMINAL</div>
    </div>

    <script language="JavaScript">
    <!--
        // PRESERVED CORE FUNCTIONALITY WITH ENHANCED JSON HANDLING
        var pressCount = 0;
        var events = [];
        var defaultStatus = "STATUS: NOMINAL";
        var rebuilding = false; // Add this at the top
        var clickDelay = true;
        var lastClick = 0;

        // Load events with error protection
        function loadEvents() {
            fetch('events.json')
                .then(response => {
                    if (!response.ok) throw new Error('Network error');
                    return response.json();
                })
                .then(data => {
                    if(data && data.events) {
                        events = data.events;
                        console.log('Loaded', events.length, 'events');
                    }
                })
                .catch(error => {
                    console.error('Event load error:', error);
                    events = [{ // Fallback event
                        condition: "pressCount >= 1",
                        message: "DEFAULT SYSTEM RESPONSE",
                        action: "document.body.style.backgroundColor='#FFEEEE'"
                    }];
                });
        }

        // Process events with template literal support
        function processEvents() {
            let messageSet = false;
            events.forEach(event => {
                try {
                    if (eval(event.condition)) {
                        if (event.message && document.getElementById('message')) {
                            const msg = event.message.replace('${pressCount}', pressCount);
                            document.getElementById('message').innerHTML = msg;
                            messageSet = true;
                        }
                        if (event.action) {
                            const action = event.action.replace(/\${pressCount}/g, pressCount);
                            eval(action);
                        }
                    }
                } catch(e) {
                    console.error("Event error:", e);
                }
            });

            // Only show version if no other message was set
            if (!messageSet && document.getElementById('message')) {
                document.getElementById('message').innerHTML = "v1.2.1 - Storyline & click delay enabled";
            }
        }

        // Initialize while preserving original flow
        loadEvents();

        // Console command to disable delay
        window.cdOFF = function() {
            clickDelay = false;
            console.log("Click delay OFF");
        };

        // Replace button click handler:
        document.getElementById('button').onclick = function() {
            if (clickDelay) {
                let now = Date.now();
                if (now - lastClick < 500) return; // 2 clicks per second
                lastClick = now;
            }
            pressCount++;
            document.getElementById('counter').innerHTML = "PRESSES: " + pressCount;
            this.style.transform = "translateY(4px)";
            setTimeout(() => { this.style.transform = ""; }, 100);
            processEvents();
        };

        // Restart game function
        function restartGame() {
            rebuilding = true; // Set flag

            // Step 1: Clear everything
            document.body.innerHTML = `<div id="container"></div>`;
            const container = document.getElementById('container');
            pressCount = 0;

            // Step 2: Add button first
            setTimeout(() => {
                const btn = document.createElement('div');
                btn.id = 'button';
                btn.style.width = '150px';
                btn.style.height = '150px';
                btn.style.backgroundColor = '#FF0000';
                btn.style.margin = '20px auto';
                btn.style.border = '4px outset #880000';
                btn.style.cursor = 'pointer';
                btn.style.display = 'block';
                btn.style.transition = 'all 0.1s ease';
                btn.style.boxShadow = '0 5px 0 #CC0000';
                btn.style.position = 'relative';
                container.appendChild(btn);

                btn.onclick = function() {
                    pressCount++;
                    if (document.getElementById('counter')) {
                        document.getElementById('counter').innerHTML = "PRESSES: " + pressCount;
                    }
                    this.style.transform = "translateY(4px)";
                    setTimeout(() => { this.style.transform = ""; }, 100);
                    processEvents();
                };
            }, 400);

            // Step 3: Add counter
            setTimeout(() => {
                const counter = document.createElement('div');
                counter.id = 'counter';
                counter.className = 'counter';
                counter.innerHTML = "PRESSES: 0";
                container.appendChild(counter);
            }, 800);

            // Step 4: Add message
            setTimeout(() => {
                const message = document.createElement('div');
                message.id = 'message';
                message.className = 'message';
                message.innerHTML = "STATUS: NOMINAL";
                container.appendChild(message);
            }, 1200);

            // Step 5: Add knob (hidden)
            setTimeout(() => {
                const knob = document.createElement('div');
                knob.id = 'knob';
                knob.style.display = 'none';
                container.appendChild(knob);
                knob.onclick = function() {
                    knob.style.transform = 'rotate(' + (Math.random()*360) + 'deg)';
                    if (document.getElementById('message')) {
                        document.getElementById('message').innerHTML = "You turned the knob. Satisfied?";
                    }
                };
            }, 1600);

            // Step 6: Add button body (hidden)
            setTimeout(() => {
                const body = document.createElement('div');
                body.id = 'button-body';
                body.style.display = 'none';
                container.appendChild(body);
            }, 2000);

            // Step 7: Add title
            setTimeout(() => {
                const title = document.createElement('h1');
                title.innerHTML = "<blink>⚠️ DANGER ⚠️</blink>";
                container.insertBefore(title, container.firstChild);
            }, 2400);

            // Step 8: Reload events
            setTimeout(() => {
                loadEvents();
                rebuilding = false; // Clear flag, events can run again

                // Re-attach button click handler
                const btn = document.getElementById('button');
                if (btn) {
                    btn.onclick = function() {
                        pressCount++;
                        if (document.getElementById('counter')) {
                            document.getElementById('counter').innerHTML = "PRESSES: " + pressCount;
                        }
                        this.style.transform = "translateY(4px)";
                        setTimeout(() => { this.style.transform = ""; }, 100);
                        processEvents();
                    };
                }
            }, 2600);
        }

        // Make restartGame globally accessible for event actions
        window.restartGame = restartGame;

        var clickerScore = 0;
        var overloadActive = false;

        function showOverloadGUI() {
            if (document.getElementById('overload-panel')) return; // Prevent duplicates
            overloadActive = true;

            // Create panel
            let panel = document.createElement('div');
            panel.id = 'overload-panel';
            panel.style.background = '#F0F0F0';
            panel.style.border = '3px double #000';
            panel.style.padding = '20px';
            panel.style.margin = '30px auto';
            panel.style.width = '500px';
            panel.style.maxWidth = '95vw';
            panel.style.borderRadius = '16px';
            panel.style.boxShadow = '0 8px 24px #8888';
            panel.style.fontFamily = '"Times New Roman", Times, serif';
            panel.style.display = 'flex';
            panel.style.flexDirection = 'column';
            panel.style.alignItems = 'center';

            // Title
            let title = document.createElement('h2');
            title.innerText = "BUTTON OVERLOAD MODE";
            title.style.color = "#FF0000";
            title.style.textShadow = "2px 2px #880000";
            title.style.marginBottom = "10px";
            panel.appendChild(title);

            // Clicker counter
            let scoreDiv = document.createElement('div');
            scoreDiv.id = 'clicker-score';
            scoreDiv.style.fontSize = '1.5em';
            scoreDiv.style.marginBottom = '16px';
            scoreDiv.style.color = '#000';
            scoreDiv.innerText = "Clicker Score: 0";
            panel.appendChild(scoreDiv);

            // Slider
            let sliderRow = document.createElement('div');
            sliderRow.style.marginBottom = '16px';
            let sliderLabel = document.createElement('label');
            sliderLabel.innerText = "Slider: ";
            sliderLabel.style.color = "#000";
            sliderLabel.style.fontSize = "1.2em";
            sliderLabel.style.fontFamily = '"Times New Roman", Times, serif';

            let slider = document.createElement('input');
            slider.type = 'range';
            slider.min = '0';
            slider.max = '100';
            slider.value = '50';
            slider.style.width = '200px';
            slider.style.verticalAlign = 'middle';
            slider.oninput = function() {
                clickerScore += 2;
                scoreDiv.innerText = "Clicker Score: " + clickerScore;
                sliderValue.innerText = slider.value;
                updateChat();
            };

            let sliderValue = document.createElement('span');
            sliderValue.id = 'slider-value';
            sliderValue.innerText = '50';
            sliderValue.style.color = "#FF0000";
            sliderValue.style.fontSize = "1.2em";
            sliderValue.style.fontFamily = '"Times New Roman", Times, serif';
            sliderValue.style.marginLeft = "8px";

            sliderLabel.appendChild(slider);
            sliderRow.appendChild(sliderLabel);
            sliderRow.appendChild(sliderValue);
            panel.appendChild(sliderRow);

            // Fake chat
            let chatBox = document.createElement('div');
            chatBox.style.background = "#DDDDDD";
            chatBox.style.padding = "20px";
            chatBox.style.borderRadius = "10px";
            chatBox.style.width = "400px";
            chatBox.style.maxWidth = "90vw";
            chatBox.style.margin = "20px 0";
            chatBox.style.border = "2px solid #999";
            chatBox.style.fontFamily = "Arial, Helvetica, sans-serif";
            chatBox.id = "overload-chat";
            panel.appendChild(chatBox);

            function updateChat() {
                let chat = [
                    '<div style="color:#FF0000;font-size:1.2em;margin-bottom:10px;font-family:Times New Roman, Times, serif;">Fake Chat:</div>',
                    '<div style="color:#000;font-size:1em;margin-bottom:5px;">ButtonBot: Wow, you really like clicking.</div>',
                    '<div style="color:#000;font-size:1em;margin-bottom:5px;">You: My score is ' + clickerScore + '!</div>',
                    clickerScore > 20 ? '<div style="color:#000;font-size:1em;margin-bottom:5px;">ButtonBot: You\'re unstoppable!</div>' : '',
                    clickerScore > 50 ? '<div style="color:#000;font-size:1em;margin-bottom:5px;">ButtonBot: Okay, now you\'re just showing off.</div>' : '',
                    clickerScore > 100 ? '<div style="color:#000;font-size:1em;margin-bottom:5px;">ButtonBot: Is this the endgame?</div>' : ''
                ].join('');
                chatBox.innerHTML = chat;
            }
            updateChat();

            // Add panel to container
            document.getElementById('container').appendChild(panel);

            // Update main button to increment clickerScore
            var mainBtn = document.getElementById('button');
            mainBtn.onclick = function() {
                if (clickDelay) {
                    let now = Date.now();
                    if (now - lastClick < 500) return;
                    lastClick = now;
                }
                pressCount++;
                document.getElementById('counter').innerHTML = "PRESSES: " + pressCount;
                if (overloadActive) {
                    clickerScore += 1;
                    scoreDiv.innerText = "Clicker Score: " + clickerScore;
                    updateChat();
                }
                this.style.transform = "translateY(4px)";
                setTimeout(() => { this.style.transform = ""; }, 100);
                processEvents();
            };
        }
    //-->
    </script>
</body>
</html>
