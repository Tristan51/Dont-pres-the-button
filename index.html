<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<head>
    <title>WARNING: DO NOT PRESS THE BUTTON</title>
    <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
    <style>
        /* ALL YOUR EXISTING STYLES REMAIN UNCHANGED */
        body {
            background-color: #FFFFFF;
            margin: 0;
            padding: 0;
            font-family: "Times New Roman", Times, serif;
            color: #000000;
            text-align: center;
        }
        #container {
            width: 600px;
            margin: 20px auto;
            border: 3px double #000000;
            padding: 10px;
            background-color: #F0F0F0;
        }
        #button {
            width: 150px;
            height: 150px;
            background-color: #FF0000 !important;
            margin: 20px auto;
            border: 4px outset #880000 !important;
            cursor: pointer;
            display: block;
            transition: all 0.1s ease;
            box-shadow: 0 5px 0 #CC0000;
            position: relative;
        }
        #button:active {
            transform: translateY(5px);
            box-shadow: 0 2px 0 #CC0000;
            border-style: inset !important;
        }
        .counter { /* ... keep existing ... */ }
        .message { /* ... keep existing ... */ }
        /* ALL OTHER STYLES REMAIN */
    </style>
</head>
<body bgcolor="#FFFFFF" text="#000000">
    <div id="container">
        <h1><blink>⚠️ DANGER ⚠️</blink></h1>
        <div id="counter">PRESSES: 0</div>
        <div id="button"></div>
        <div id="message">STATUS: NOMINAL</div>
    </div>

    <script language="JavaScript">
    <!--
        // FIXED VERSION - PROPER JSON HANDLING
        var pressCount = 0;
        var events = [];
        var defaultMessage = "STATUS: NOMINAL";

        // Load JSON events (with error handling)
        function loadEvents() {
            fetch('events.json')
                .then(response => {
                    if (!response.ok) throw new Error("Network response was not ok");
                    return response.json();
                })
                .then(data => {
                    events = data.events || [];
                    console.log("Loaded", events.length, "events");
                })
                .catch(error => {
                    console.error("Error loading events:", error);
                    // Fallback events if JSON fails
                    events = [
                        {
                            condition: "pressCount >= 1",
                            message: "DEFAULT: BUTTON PRESSED",
                            action: "document.body.style.backgroundColor='#FFEEEE'"
                        }
                    ];
                });
        }

        // Process events with safe evaluation
        function processEvents() {
            var messageSet = false;
            
            events.forEach(event => {
                try {
                    if (eval(event.condition || "false")) {
                        if (event.message) {
                            document.getElementById('message').innerHTML = event.message;
                            messageSet = true;
                        }
                        if (event.action) {
                            try {
                                eval(event.action);
                            } catch (e) {
                                console.error("Action failed:", e);
                            }
                        }
                    }
                } catch (e) {
                    console.error("Condition error:", e);
                }
            });
            
            if (!messageSet) {
                document.getElementById('message').innerHTML = defaultMessage;
            }
        }

        // Initialize
        loadEvents();

        // Button handler
        document.getElementById('button').onclick = function() {
            pressCount++;
            document.getElementById('counter').innerHTML = "PRESSES: " + pressCount;
            processEvents();
        };
    //-->
    </script>
</body>
</html>
